# 星币管理系统

一个用于管理学生星币的Web应用，支持Excel导入导出和API同步功能。

## 功能特性

- 班级管理：添加、删除、切换班级
- 学生管理：添加、编辑、删除学生
- 星币操作：单个学生、批量操作、全班操作
- Excel导入导出：支持追加和覆盖模式
- 搜索和排序功能
- 学生行点击选择功能
- 滚动显示的浮动操作栏
- API同步功能：将星币数据同步到编程平台

## 技术栈

- HTML/CSS/JavaScript
- LocalStorage数据持久化
- SheetJS处理Excel文件
- Node.js代理服务器（用于绕开CORS拦截）

## 快速开始

### 1. 安装代理服务器依赖

```bash
npm install
```

### 2. 启动代理服务器

```bash
node proxy.js
```

代理服务器将在端口3000上运行，用于转发API请求，绕开浏览器的CORS拦截。

### 3. 启动前端服务器

在另一个终端窗口中运行：

```bash
python -m http.server 8000
```

前端服务器将在端口8000上运行。

### 4. 访问应用

在浏览器中访问：

```
http://localhost:8000
```

## API配置

1. 点击右上角的"API配置"按钮
2. 填写API密钥
3. 其他配置项已经默认设置为代理服务器地址，无需修改
4. 点击"保存配置"按钮

## 同步星币数据

1. 点击右上角的"同步到编程网站"按钮
2. 选择同步模式（所有学生、当前班级、选中学生）
3. 点击"开始同步"按钮
4. 等待同步完成，查看同步结果

## 代理服务器说明

### 配置文件

- `package.json`：代理服务器的依赖配置
- `proxy.js`：代理服务器的主要代码

### 代理规则

- 前端API请求地址：`http://localhost:3000/api`
- 实际API地址：`https://steam.fun/java-api/points/sch`
- 路径映射：
  - `/api/stuStar/queryList` → `https://steam.fun/java-api/points/sch/stuStar/queryList`
  - `/api/starGrant/activeGrant` → `https://steam.fun/java-api/points/sch/starGrant/activeGrant`

### 代理服务器功能

- 处理CORS请求，允许所有域名访问
- 转发API请求到实际服务器
- 保留原请求的查询参数和请求体
- 记录请求日志

## 项目结构

```
start_test/
├── index.html          # 主页面
├── script.js           # 核心逻辑
├── styles.css          # 样式文件
├── package.json        # 代理服务器依赖
├── proxy.js            # 代理服务器代码
├── README.md           # 项目说明
└── .trae/              # 项目文档
```

## 使用说明

### 添加班级

1. 点击"添加班级"按钮
2. 输入班级名称
3. 点击"确定添加"按钮

### 添加学生

1. 选择一个班级
2. 在"学生姓名"输入框中输入姓名
3. 在"初始星币数量"输入框中输入星币数量
4. 点击"添加学生"按钮

### 导入Excel

1. 点击"导入Excel"按钮
2. 选择导入模式（追加或覆盖）
3. 选择Excel文件
4. 等待导入完成

### 导出Excel

1. 选择要导出的班级（可以选择"所有班级"）
2. 点击"导出Excel"按钮
3. 保存Excel文件

### 批量操作

1. 选择多个学生（点击学生行或复选框）
2. 点击"选中加星币"或"选中减星币"按钮
3. 输入星币数量
4. 点击"确定"按钮

## 浏览器兼容性

- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 注意事项

1. 代理服务器需要Node.js环境
2. 确保代理服务器和前端服务器都在运行
3. API密钥需要正确配置
4. 同步功能需要网络连接
5. 数据保存在浏览器的LocalStorage中，清除浏览器数据会丢失数据

## 故障排除

### 代理服务器无法启动

- 检查Node.js是否安装：`node -v`
- 检查端口3000是否被占用：`netstat -ano | findstr :3000`
- 重新安装依赖：`npm install`

### API请求失败

- 检查代理服务器是否在运行
- 检查API密钥是否正确
- 检查网络连接
- 查看代理服务器日志，了解具体错误信息

### Excel导入失败

- 检查Excel文件格式是否正确
- 确保Excel文件包含"姓名"列
- 检查Excel文件是否损坏

## 更新日志

- v1.0.0：初始版本，包含基本功能
- v1.1.0：添加Excel导入导出功能
- v1.2.0：添加API同步功能
- v1.3.0：添加浮动操作栏和行点击选择功能
- v1.4.0：添加代理服务器，绕开CORS拦截

## 许可证

MIT
